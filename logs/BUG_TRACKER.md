# REForum Bug Tracker

本文档记录每次版本更新迭代中出现的 Bug 及其修复情况。

---

## 2025-12-08 - v1.9.4

### Bug #038: VITE_ENABLE_TEST_LOGIN 环境变量逻辑不正确

**严重程度**: 低  
**影响范围**: 开发/测试环境  
**状态**: ✅ 已修复

**问题描述**:
- `VITE_ENABLE_TEST_LOGIN` 环境变量的逻辑不正确
- 即使设置为 `false`，在开发环境中仍然可能启用测试登录
- 环境变量应该在测试环境中才生效，且必须明确设置为 `true` 才能启用

**复现步骤**:
1. 在 `.env` 文件中设置 `VITE_ENABLE_TEST_LOGIN=false`
2. 在开发环境中运行应用
3. 发现测试登录功能仍然可用（不应该可用）

**根本原因**:
- 之前的逻辑是：如果 `VITE_ENABLE_TEST_LOGIN` 不是 `'false'`，且在开发环境中，就会启用测试登录
- 这意味着即使没有设置环境变量，在开发环境中也会启用测试登录
- 没有严格检查环境变量必须明确设置为 `'true'`

**修复方案**:
- 修改逻辑：只有在开发/测试环境中，且 `VITE_ENABLE_TEST_LOGIN` 明确设置为 `'true'` 时才启用测试登录
- 在生产环境中，无论设置什么值都禁用测试登录
- 更新 `AuthContext.jsx` 和 `Header.jsx` 中的测试登录检查逻辑
- 添加调试信息帮助诊断问题

**修复文件**:
- `frontend/src/context/AuthContext.jsx`
- `frontend/src/components/Header.jsx`

**测试验证**:
- ✅ 验证 `VITE_ENABLE_TEST_LOGIN=true` 时，在开发环境中可以使用测试登录
- ✅ 验证 `VITE_ENABLE_TEST_LOGIN=false` 时，在开发环境中不能使用测试登录
- ✅ 验证未设置环境变量时，在开发环境中不能使用测试登录
- ✅ 验证在生产环境中，无论设置什么值都不能使用测试登录

---

### Bug #037: 响应式设备上用户名、称号和编辑按钮间距冲突

**严重程度**: 低  
**影响范围**: 移动端用户（用户资料页面）  
**状态**: ✅ 已修复

**问题描述**:
- 在响应式设备上，用户名与编辑资料按钮靠得太近
- 旁边的称号与下面的按钮会发生冲突
- 导致布局混乱，影响用户体验

**复现步骤**:
1. 在移动设备或小屏幕浏览器上打开用户资料页面
2. 查看用户名、称号和编辑资料按钮的布局
3. 发现它们之间的间距不足，导致视觉冲突

**根本原因**:
- `profile-username-row` 的 `gap` 设置为 `0.75rem`，间距不足
- `profile-username-wrapper` 没有底部间距
- `edit-profile-button` 没有顶部间距

**修复方案**:
- 增加 `profile-username-row` 的 `gap` 从 `0.75rem` 到 `1rem`
- 为 `profile-username-wrapper` 添加 `margin-bottom: 0.5rem`
- 为 `edit-profile-button` 添加 `margin-top: 0.5rem`
- 确保在 768px 和 480px 断点都应用这些修复

**修复文件**:
- `frontend/src/pages/UserProfile.css`

**测试验证**:
- ✅ 验证在移动设备上，用户名、称号和编辑按钮之间有足够的间距
- ✅ 验证不再出现视觉冲突
- ✅ 验证布局清晰易读

---

### Bug #036: 编辑资料时请求参数验证失败

**严重程度**: 中等  
**影响范围**: 所有用户（编辑资料功能）  
**状态**: ✅ 已修复

**问题描述**:
- 点击编辑资料保存按钮后，报错"请求参数验证失败"
- 错误发生在后端验证请求参数时
- 导致用户无法保存资料修改

**复现步骤**:
1. 打开用户资料页面
2. 点击"编辑资料"按钮
3. 修改资料（头像、简介、用户名或称号）
4. 点击"保存"按钮
5. 出现"请求参数验证失败"错误

**根本原因**:
- 后端验证规则要求 `avatar` 必须是有效的 URL，但前端可能发送 `null` 或空字符串
- 后端验证规则对可选字段的处理不够灵活
- 前端发送了所有字段，包括未修改的字段，导致验证失败

**修复方案**:
- 后端：修改 `validateUpdateProfile` 验证规则，使用自定义验证函数
- 后端：允许 `avatar`、`bio`、`username`、`tag` 为 `null`、`undefined` 或空字符串
- 后端：如果提供了值，则检查格式和长度
- 前端：只发送有变化的字段，避免发送未修改的数据
- 前端：空值转换为 `null`，而不是空字符串
- 前端：如果没有字段被修改，直接关闭弹窗，不发送请求

**修复文件**:
- `backend/middleware/validation.js`
- `frontend/src/components/EditProfileModal.jsx`

**测试验证**:
- ✅ 验证编辑资料时可以正常保存
- ✅ 验证只修改部分字段时不会报错
- ✅ 验证空值字段可以正常处理
- ✅ 验证未修改任何字段时不会发送请求

---

## 2025-12-08 - v1.9.3

### Bug #035: startsWith 方法调用错误

**严重程度**: 中等  
**影响范围**: 所有用户（登录、注册、用户资料等功能）  
**状态**: ✅ 已修复

**问题描述**:
- 用户界面报错：`error.occurred` 和 `s.startsWith is not a function`
- 错误发生在多个组件中调用 `startsWith` 方法时
- 当变量值为 `null`、`undefined` 或非字符串类型时，调用 `startsWith` 方法会抛出错误
- 影响登录、注册、用户资料、编辑资料等多个功能模块

**复现步骤**:
1. 访问用户界面，触发登录、注册或查看用户资料等操作
2. 控制台出现错误：`TypeError: s.startsWith is not a function` 或类似错误
3. 界面显示 `error.occurred` 错误提示

**根本原因**:
- 多个组件中直接对可能为 `null`、`undefined` 或非字符串类型的值调用 `startsWith` 方法
- `token`、`userId`、`user.id`、`result.error` 等变量可能不是字符串类型
- 使用可选链 `?.` 只能防止 `null`/`undefined` 错误，但不能防止非字符串类型错误

**修复方案**:
- 在所有调用 `startsWith` 方法前，使用 `String()` 将值转换为字符串
- 修复 `AuthContext.jsx` 中的 `isTestUser` 函数
- 修复 `LoginModal.jsx` 和 `RegisterModal.jsx` 中的错误处理逻辑
- 修复 `UserProfile.jsx`、`dailyTasks.js`、`api.js`、`EditProfileModal.jsx` 中的 `startsWith` 调用
- 确保所有字符串方法调用前都进行类型转换

**修复文件**:
- `frontend/src/context/AuthContext.jsx`
- `frontend/src/components/LoginModal.jsx`
- `frontend/src/components/RegisterModal.jsx`
- `frontend/src/pages/UserProfile.jsx`
- `frontend/src/utils/dailyTasks.js`
- `frontend/src/services/api.js`
- `frontend/src/components/EditProfileModal.jsx`

**测试验证**:
- ✅ 验证登录功能不再出现 `startsWith` 错误
- ✅ 验证注册功能不再出现 `startsWith` 错误
- ✅ 验证用户资料页面正常显示
- ✅ 验证编辑资料功能正常工作
- ✅ 验证所有使用 `startsWith` 的地方都正确处理了类型转换

---

## 2025-12-08 - v1.9.2

### Bug #034: 经验值条显示不正确

**严重程度**: 中等  
**影响范围**: 所有用户（用户资料页面）  
**状态**: ✅ 已修复

**问题描述**:
- 当用户在数据库中修改了用户的 `exp` 字段后，用户资料页面的经验值条仍然显示旧的经验值
- 70级用户的经验值条显示为1级状态（30经验值），而不是满级状态
- 经验值条从 localStorage 读取经验值，而不是从服务器获取的用户数据

**复现步骤**:
1. 在数据库中修改用户的 `exp` 字段（例如设置为70级对应的经验值）
2. 刷新用户资料页面
3. 发现经验值条仍然显示旧的经验值或显示为1级状态

**根本原因**:
- `getUserExp` 函数不接受 `user` 参数，总是从 localStorage 读取经验值
- `UserProfile.jsx` 中使用 `user.exp || getUserExp()`，当 `user.exp` 为 0 时会被误判为 falsy
- `ExpProgressBar` 组件传递了 `user` 参数，但 `getUserExp` 函数没有使用它

**修复方案**:
- 修改 `getUserExp` 函数，接受 `user` 参数，优先使用 `user.exp`（如果存在）
- 仅在 `user` 不存在或 `user.exp` 未定义时才从 localStorage 读取
- 修改 `UserProfile.jsx`，直接使用 `getUserExp(user)` 而不是 `user.exp || getUserExp()`
- 确保经验值从服务器实时获取，而不是使用本地缓存

**修复文件**:
- `frontend/src/utils/dailyTasks.js`
- `frontend/src/pages/UserProfile.jsx`

**测试验证**:
- ✅ 验证在数据库中修改用户经验值后，经验值条正确显示
- ✅ 验证70级用户显示满级状态（100%进度条）
- ✅ 验证经验值从服务器实时获取，不使用本地缓存

---

### Bug #033: 帖子中作者等级不更新

**严重程度**: 中等  
**影响范围**: 所有用户（帖子显示）  
**状态**: ✅ 已修复

**问题描述**:
- 当用户在数据库中修改了用户的 `exp` 字段后，已发布帖子中显示的作者等级没有更新
- 帖子卡片和帖子详情页中的作者等级仍然显示旧等级
- 用户资料页面的等级已更新，但帖子中的等级未更新

**复现步骤**:
1. 在数据库中修改用户的 `exp` 字段（例如设置为70级对应的经验值）
2. 查看该用户之前发布的帖子
3. 发现帖子中显示的作者等级仍然是旧等级

**根本原因**:
- 后端 `Post.js` 模型在查询帖子时，没有包含作者的 `exp` 和 `tag` 字段
- `findById` 和 `findAll` 方法只查询了 `author_id`, `author_username`, `author_avatar`
- `formatPostListItem` 方法在格式化 `author` 对象时，没有包含 `exp` 和 `tag` 字段
- 前端 `PostCard.jsx` 使用 `getUserExp()` 获取当前登录用户的经验值，而不是帖子作者的经验值

**修复方案**:
- 后端：在 `Post.findById` 和 `Post.findAll` 查询中添加 `u.exp as author_exp` 和 `u.tag as author_tag`
- 后端：添加向后兼容性，如果新字段不存在，自动回退到基本查询并设置默认值
- 后端：在 `formatPostListItem` 方法中，将 `exp` 和 `tag` 添加到 `author` 对象中
- 前端：修改 `PostCard.jsx`，使用 `post.author?.exp ?? 0` 而不是 `getUserExp()`
- 前端：在 `PostDetail.jsx` 中添加作者等级显示
- 前端：移除不再需要的 `getUserExp` 导入

**修复文件**:
- `backend/models/Post.js`
- `frontend/src/components/PostCard.jsx`
- `frontend/src/pages/PostDetail.jsx`

**测试验证**:
- ✅ 验证在数据库中修改用户经验值后，所有帖子中显示的作者等级正确更新
- ✅ 验证帖子卡片和帖子详情页中的作者等级显示正确
- ✅ 验证数据库迁移未执行时，应用仍能正常运行（使用默认值）

---

## 2025-12-07 - v1.9.1

### Bug #032: 编辑资料弹窗中访问 null 对象的 daysRemaining 属性导致错误

**严重程度**: 中等  
**影响范围**: 所有用户（编辑资料功能）  
**状态**: ✅ 已修复

**问题描述**:
- 点击编辑资料按钮时，控制台报错：`Cannot read properties of null (reading 'daysRemaining')`
- 错误发生在尝试访问 `usernameUpdateInfo.daysRemaining` 或 `tagUpdateInfo.daysRemaining` 时
- 导致编辑资料弹窗无法正常显示或功能异常

**复现步骤**:
1. 登录系统
2. 打开用户资料页面
3. 点击"编辑资料"按钮
4. 控制台出现错误：`Cannot read properties of null (reading 'daysRemaining')`

**根本原因**:
- `usernameUpdateInfo` 和 `tagUpdateInfo` 初始状态为 `null`
- 在 `useEffect` 计算完成前，代码尝试访问这些对象的 `daysRemaining` 属性
- 条件判断使用了可选链 `?.`，但在访问 `daysRemaining` 时没有先检查对象是否存在

**修复方案**:
- 在访问 `daysRemaining` 前添加对象存在性检查：`usernameUpdateInfo && !usernameUpdateInfo.canModify`
- 在 `useEffect` 中添加 try-catch 错误处理，确保计算失败时设置默认值
- 当 `user` 为 `null` 时，重置 `usernameUpdateInfo` 和 `tagUpdateInfo` 为 `null`

**修复文件**:
- `frontend/src/components/EditProfileModal.jsx`

**测试验证**:
- ✅ 验证点击编辑资料按钮不再出现错误
- ✅ 验证编辑资料弹窗正常显示
- ✅ 验证用户名和称号的修改限制提示正常显示
- ✅ 验证在用户数据加载完成前不会访问 null 对象

---

### Bug #031: 登录后刷新页面自动退出登录和用户资料显示"用户不存在"

**严重程度**: 高  
**影响范围**: 所有用户（登录功能）  
**状态**: ✅ 已修复

**问题描述**:
- 用户登录后刷新页面会自动退出登录
- 登录后点击"我的资料"显示"用户不存在"错误
- 控制台报错：`TypeError: w.startsWith is not a function`
- 后端返回 500 错误：`GET /api/users/profile 500 (Internal Server Error)`

**复现步骤**:
1. 用户登录系统
2. 刷新页面
3. 发现自动退出登录，或点击"我的资料"显示"用户不存在"
4. 查看控制台，发现 `startsWith is not a function` 错误
5. 查看网络请求，发现 `/api/users/profile` 返回 500 错误

**根本原因**:
- `AuthContext.jsx` 中 `parsedUser.id` 可能是数字类型，调用 `startsWith` 方法失败
- 后端查询新字段（`exp`, `username_updated_at`, `tag_updated_at`）时，如果数据库迁移未执行，会导致 SQL 错误
- 500 错误被前端误判为认证失败，自动清除登录状态

**修复方案**:
- 前端：在调用 `startsWith` 前将 `id` 和 `token` 转换为字符串
- 前端：修改错误处理逻辑，只有 401/403 错误才清除登录状态，500 错误不清除
- 后端：添加向后兼容性，如果新字段不存在，自动回退到基本查询
- 后端：为所有新字段查询添加 try-catch 和回退逻辑
- 后端：`getStats` 方法在 `user_received_likes` 视图不存在时回退到基本查询

**修复文件**:
- `frontend/src/context/AuthContext.jsx`
- `backend/models/User.js`
- `backend/controllers/userController.js`

**测试验证**:
- ✅ 验证登录后刷新页面不会自动退出
- ✅ 验证登录后可以正常访问用户资料
- ✅ 验证数据库迁移未执行时，应用仍能正常运行（使用默认值）
- ✅ 验证控制台不再出现 `startsWith` 错误
- ✅ 验证后端 500 错误不会导致自动退出登录

---

## 2025-12-07 - v1.9.0

### Bug #030: 问题修复页面日期标签渐变背景样式

**严重程度**: 低  
**影响范围**: 所有用户（视觉体验）  
**状态**: ✅ 已修复

**问题描述**:
- 问题修复页面"最新修复"旁边日期标签使用了渐变背景，视觉效果过于复杂
- 渐变背景与整体设计风格不够统一

**修复方案**:
- 将日期标签的渐变背景改为淡红色纯色背景 `rgba(248, 113, 113, 0.16)`
- 保持其他样式不变，仅优化背景颜色

**修复文件**:
- `frontend/src/pages/Fixes.css`

**测试验证**:
- ✅ 验证日期标签背景为淡红色纯色，无渐变效果
- ✅ 确认视觉效果更简洁统一

---

### Bug #028: 用户资料页面在特定语言下排版错乱

**严重程度**: 中等  
**影响范围**: 所有用户（多语言环境）  
**状态**: ✅ 已修复

**问题描述**:
- 用户资料页面在中文、英文、日文等不同语言下，由于文本长度差异导致排版错乱
- 统计标签文本（如"加入时间"、"获赞"等）在长文本语言下会换行或溢出
- 用户名和称号区域在不同语言下对齐不一致
- 经验进度条状态文本在长文本下可能溢出容器

**复现步骤**:
1. 切换语言到日文或英文
2. 打开用户资料页面
3. 观察统计标签、用户名区域、经验进度条的显示效果
4. 发现部分文本换行、对齐错乱或溢出

**根本原因**:
- 统计区域使用固定 `flex` 布局，未考虑不同语言文本长度差异
- 文本元素缺少 `word-break` 和 `overflow-wrap` 处理
- 经验进度条状态文本未设置最大宽度和文本溢出处理
- 容器缺少 `min-width: 0` 允许收缩

**修复方案**:
- 将统计区域从固定 `flex` 改为 `grid` 布局，使用 `repeat(auto-fit, minmax(120px, 1fr))` 自适应
- 为所有文本元素添加 `word-break: break-word` 和 `overflow-wrap: break-word`
- 统计标签允许换行（`white-space: normal`）
- 经验进度条状态文本添加 `max-width` 和 `text-overflow: ellipsis`
- 容器添加 `min-width: 0` 允许收缩，防止溢出

**修复文件**:
- `frontend/src/pages/UserProfile.css`
- `frontend/src/components/ExpProgressBar.css`

**测试验证**:
- ✅ 在中文、英文、日文三种语言下验证用户资料页面布局
- ✅ 确认统计标签在所有语言下都能正确显示，不会换行错乱
- ✅ 验证用户名和称号区域对齐一致
- ✅ 确认经验进度条状态文本不会溢出容器

---

### Bug #029: 70级等级徽章彩虹渐变动画方向错误

**严重程度**: 低  
**影响范围**: 达到70级的用户（视觉体验）  
**状态**: ✅ 已修复

**问题描述**:
- 70级等级徽章的彩虹渐变动画在两个方向交替变化，而不是单向流动
- 动画效果不符合预期，应该是一个方向持续变化

**复现步骤**:
1. 将用户经验值设置为70级（15000经验）
2. 查看用户资料页面的等级徽章
3. 观察彩虹渐变动画效果
4. 发现颜色在两个方向交替变化

**根本原因**:
- 彩虹渐变动画使用了 `background-position` 动画，导致在两个方向交替
- 动画实现方式不正确，应该使用 `filter: hue-rotate()` 实现单向颜色变化

**修复方案**:
- 移除 `background-position` 动画
- 使用 `filter: hue-rotate()` 实现单向颜色旋转
- 调整动画持续时间为18秒，使颜色变化更流畅
- 更新 `getRainbowGradient` 函数，使用时间计算单向色相变化

**修复文件**:
- `frontend/src/components/LevelBadge.jsx`
- `frontend/src/components/LevelBadge.css`
- `frontend/src/utils/levelSystem.js`

**测试验证**:
- ✅ 验证70级等级徽章彩虹渐变动画单向流动
- ✅ 确认颜色变化流畅，无卡顿或跳跃
- ✅ 验证动画速度适中（约6秒完成一次360度循环）

---

## 2025-12-05 - v1.8.0

### Bug #027: 登录注册弹窗定位、用户协议弹窗闪烁与侧边栏动画卡顿

**严重程度**: 中等  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 登录和注册弹窗跟随页面滚动，位置不居中，显示不全
- 用户协议和隐私政策弹窗闪烁，无法稳定显示
- 侧边栏手风琴关闭动画卡顿

**修复方案**:
- 使用 React Portal 将登录和注册弹窗渲染到 `document.body`，确保弹窗固定在浏览器视口中间
- 使用 `useMemo` 和 `useCallback` 优化状态管理，避免不必要的重新渲染
- 使用 CSS Grid 的 `grid-template-rows` 替代 `max-height`，优化手风琴关闭动画

**修复文件**:
- `frontend/src/components/LoginModal.jsx`
- `frontend/src/components/RegisterModal.jsx`
- `frontend/src/components/Modal.css`
- `frontend/src/components/Sidebar.css`

---

## 2025-12-03 - v1.7.2

### Bug #026: 移动端日历头部错位、Cookie 提示被遮挡、通知列表不同步

**严重程度**: 中等  
**影响范围**: 移动端与小屏幕用户  
**状态**: ✅ 已修复

**问题描述**:
- 首页日历在 768px / 480px 以下断点时，上一周 / 下一周 / 月份按钮 / 展开图标整组偏向右侧，图标未能保持居中，对齐错乱
- Cookie 同意横幅在手机端仍固定在页面底部，`接受` 按钮会被底部“工具集”浮动按钮覆盖，用户无法点击
- Inbox 通知只轮询未读数量，在移动端打开通知弹窗时并不会真正去请求通知列表，导致图标显示有未读但列表为空

**复现步骤**:
1. 在移动端或浏览器移动模式下打开首页，观察日历头部按钮位置，发现图标挤在右侧  
2. 触发 Cookie 提示（通过清除本地存储），在移动端看到横幅位于底部且 Accept 按钮被覆盖  
3. 使用登录账号让另一账号发帖触发通知，在手机端点击右上角通知按钮，看到徽章显示 1 条但列表为空

**根本原因**:
- 日历头部样式在小屏断点仍沿用桌面布局，`justify-content` 没有针对移动端调整，导致按钮组无法居中
- Cookie 提示组件只在桌面端考虑底部定位，移动端未覆写定位，导致与固定在底部的工具集按钮冲突
- `Inbox.jsx` 中 `fetchNotifications()` 仅在桌面端点击外部关闭的 effect 内调用，移动端 `showDropdown` 为 true 时没有拉取通知列表，只依靠未读数量轮询

**修复方案**:
- 在 `Home.css` 中为 `<768px` 与 `<480px` 的断点重新定义 `.calendar-header` 与 `.calendar-controls` 的对齐策略，使整组按钮在小屏幕上一行居中
- 在 `CookieConsent.css` 中为移动端设置 `top: 0; bottom: auto;`，让横幅在手机上固定到顶部，确保按钮不被遮挡
- 调整 `Inbox.jsx`：拆分桌面端“点击外部关闭”监听逻辑，并新增一个 effect 在 `showDropdown && isAuthenticated` 时统一调用 `fetchNotifications()`，保证移动端打开弹窗时会获取最新数据

**修复文件**:
- `frontend/src/pages/Home.css`
- `frontend/src/components/CookieConsent.css`
- `frontend/src/components/Inbox.jsx`

**测试验证**:
- ✅ 在 375px / 414px / 768px 等视口下，日历头部按钮保持居中且间距一致  
- ✅ 在手机端触发 Cookie 横幅，确认横幅显示在顶部且 Accept 按钮完全可见  
- ✅ 在移动端打开通知弹窗时立即获取最新通知，徽章数量与列表内容一致  
- ✅ 桌面端通知弹窗和 Cookie 横幅行为保持原状，无回归问题

---

## 2025-12-03 - v1.7.1

### Bug #025: 日历按日期筛选与帖子数量徽章在真实后端环境失效

**严重程度**: 中等  
**影响范围**: 所有使用首页日历视图的用户  
**状态**: ✅ 已修复

**问题描述**:
- 首页日历在接入真实后端数据后，点击某个日期并不会刷新帖子列表，始终停留在默认的时间段  
- 日历中每个日期右上角用于展示当天帖子数量的小徽章，只在本地 Mock 数据环境下能正确显示，在部署到真实服务器后始终为 0 或不显示  
- URL 虽然会在某些情况下包含 `?date=YYYY-MM-DD`，但这个参数没有真正驱动后端筛选  

**复现步骤**:
1. 在线上环境打开首页，切换到有日期视图的区域  
2. 点击任意一个有帖子的小圆点日期  
3. 观察右侧/下方帖子列表，发现内容没有切换到该日期发布的帖子  
4. 刷新页面或直接访问带 `?date=某一天` 的 URL，帖子列表依然不按日期过滤  
5. 对比本地使用 Mock 数据的环境，可以看到数量徽章正常、但点击后在真实后端下不会生效

**根本原因**:
- 帖子列表请求函数 `fetchPosts` 的触发条件只依赖 `page/sort/category`，没有监听 URL 中 `searchParams` 的变化，导致点击日历修改了 `?date=` 却不会重新发起请求  
- 虽然请求参数结构中预留了 `params.date`，但因为未走到带 `dateParam` 的分支，真实后端从未收到日期过滤条件  
- 日期分组与数量统计 `groupPostsByDate(allPosts)` 所依赖的 `allPosts` 只在特定请求成功后才更新，一旦真实环境请求失败或未触发，`postsByDate` 就为空

**修复方案**:
- 将 `debouncedFetchPosts` 的触发依赖从 `[pagination.page, sort, selectedCategory]` 扩展为 `[pagination.page, sort, selectedCategory, searchParams]`，确保点击日历修改 URL 后会重新请求  
- 在 `fetchPosts` 中读取 `const dateParam = searchParams.get('date')`，当存在时将其透传给后端：`params.date = dateParam`，由后端按日期执行过滤  
- 保留并强化 `fetchAllPostsForGrouping()` 调用逻辑，使其在成功请求后使用真实返回的帖子数组更新 `allPosts`，供日历数量徽章使用  
- 在有 `dateParam` 的情况下，热门模式对当前日期的帖子计算热门分数并排序，避免逻辑与默认视图不一致

**修复文件**:
- `frontend/src/pages/Home.jsx`

**测试验证**:
- ✅ 在真实后端环境下多次点击不同日期，帖子列表都会切换到对应日期的帖子  
- ✅ 验证日历上每个有帖子日期的右上角数量徽章与后端返回的数据一致  
- ✅ 使用 `?date=YYYY-MM-DD&sort=time`、`?date=YYYY-MM-DD&sort=hot` 直接访问页面时，列表内容与排序逻辑均正确  
- ✅ 在网络错误或后端异常时，日期分组安全回退，不会导致前端崩溃

---

### Bug #024: 移动端工具集中的头像菜单被底部按钮遮挡

**严重程度**: 低  
**影响范围**: 移动端与小屏幕已登录用户  
**状态**: ✅ 已修复

**问题描述**:
- 在移动端底部“工具集”弹窗中，头像按钮被放在工具列表的最下方
- 点击头像后弹出的用户菜单（个人资料 / 退出登录）默认向下展开
- 由于按钮本身位于底部，菜单会被底部工具集按钮或屏幕边缘遮挡，实际内容难以看清或无法完全点击

**复现步骤**:
1. 在手机或浏览器移动端模式下登录账户并打开任意页面  
2. 点击底部中间的“工具集”按钮，拉起工具列表  
3. 点击列表最底部的头像按钮，观察弹出的用户菜单位置  
4. 发现菜单内容被底部区域部分或全部遮住

**根本原因**:
- 用户菜单组件复用了桌面端的定位方式：`.user-dropdown` 统一以 `top: calc(100% + 0.5rem)` 自按钮下方展开  
- 在移动端动作面板中，头像按钮本身距离视口底部很近，导致“从下往下”展开的菜单超出可视区域，被底部按钮或屏幕边缘遮挡

**修复方案**:
- 保持桌面端行为不变，仅针对移动端工具集弹窗内部的头像菜单增加一个更高优先级的样式：  
  - 当头像按钮位于 `.header-actions-group-mobile .user-menu` 中时，将 `.user-dropdown` 的展开方向改为向上  
  - 使用 `top: auto; bottom: calc(100% + 0.5rem);` 使菜单从头像按钮上方弹出，避免被底部工具集按钮遮挡

**修复文件**:
- `frontend/src/components/Header.css`

**测试验证**:
- ✅ 在移动端工具集弹窗中点击头像按钮，菜单从按钮上方向上展开，所有选项均完全可见  
- ✅ 在桌面端右上角点击头像按钮，菜单仍然按原逻辑从按钮下方展开，行为未受影响  
- ✅ 各种移动端视口（含超小屏）均可完整看到“个人资料”和“退出登录”等菜单项

---

## 2025-12-03 - v1.7.0

### Bug #023: 移动端工具集按钮与工具列表排版混乱

**严重程度**: 中等  
**影响范围**: 移动端与小屏幕用户  
**状态**: ✅ 已修复

**问题描述**:
- 底部“工具集”按钮随页面整体滚动，无法始终停留在视口底部中央，使用体验割裂
- 打开工具集时弹窗可能覆盖按钮本身，关闭逻辑不统一（有时只能点遮罩/叉号）
- 工具集内各工具行（主题颜色、夜间模式、语言切换、通知、发布、用户菜单）文字与图标对齐不统一，有的图标停在中间，有的贴右侧，行间距不一致
- 移动端主题颜色选择和通知列表弹窗在部分分辨率下会被截断或超出屏幕

**复现步骤**:
1. 在手机或浏览器移动端模式下打开首页  
2. 向下滚动页面，观察底部“工具集”按钮是否会跟随整体内容一起下移  
3. 点击“工具集”按钮，观察弹出的工具列表是否覆盖按钮，以及能否通过再次点击按钮关闭  
4. 在工具集中依次查看各行按钮，留意文字与图标是否在一条竖线上、行间距是否均匀  
5. 分别点击主题颜色按钮与通知按钮，检查弹出的面板在小屏是否完整可见

**根本原因**:
- 工具集按钮嵌套在 Header 结构内部，仅靠普通定位，受父级布局与滚动影响，未真正相对视口固定  
- 工具集弹窗缺少明确的打开/关闭状态机，关闭只依赖部分交互路径，且遮罩层与按钮的层级关系不一致  
- 各工具行分别使用不同按钮/容器结构（`button` / `div`），缺少统一的 flex 布局规范和对齐规则  
- 移动端主题与通知面板使用的弹出样式与位置计算未专门为小屏视口裁剪，易产生遮挡或溢出

**修复方案**:
- 使用 `createPortal` 将底部“工具集”按钮从 Header 布局中抽离，挂载到 `document.body`，并通过 `position: fixed` + 居中定位保证始终位于视口底部中央  
- 新增 `isClosingActions` 状态，将工具集弹窗打开与关闭拆分为两个阶段，分别附加上滑/下滑动画，并统一通过按钮、遮罩和关闭图标调用同一关闭逻辑  
- 规范工具集内部的所有按钮：在移动端模式下统一为“左侧 label（`flex: 1`）、右侧 icon”的 flex 行布局，并统一行内/行间间距  
- 将移动端主题颜色选择与通知列表改为居中模态，使用固定定位和 body 滚动锁定，确保在小屏幕下也能完整显示

**修复文件**:
- `frontend/src/components/Header.jsx`
- `frontend/src/components/Header.css`
- `frontend/src/components/ThemeColorPicker.jsx`
- `frontend/src/components/ThemeColorPicker.css`
- `frontend/src/components/Inbox.jsx`
- `frontend/src/components/Inbox.css`
- `frontend/src/components/Sidebar.jsx`
- `frontend/src/components/Sidebar.css`

**测试验证**:
- ✅ 在多款移动设备与浏览器开发者工具中验证底部“工具集”按钮始终固定在视口底部中央  
- ✅ 重复点击“工具集”按钮、遮罩和右上角关闭图标，确认弹窗开启/关闭行为一致，且带有平滑动画  
- ✅ 检查工具集列表中所有行的文字列与图标列垂直对齐、间距统一  
- ✅ 在不同小屏分辨率下验证主题颜色选择器和通知列表完整可见，不再被裁切  

---

## 2025-12-03 - v1.6.1

### Bug #021: Header 搜索与时间模块在不同断点错位

**严重程度**: 中等  
**影响范围**: 桌面端与移动端用户  
**状态**: ✅ 已修复

**问题描述**:
- 搜索框仍位于中间，无法与 Logo 形成统一的左侧布局
- 新增日期/时间模块在 992px 以下断点无法保持居中，内容被挤压或换行
- Header actions 区域在 768px 以下断点换行混乱，按钮溢出或堆叠
- 日期的“日”字号与颜色过于突出，整体视觉失衡

**复现步骤**:
1. 打开首页，将浏览器宽度依次调整为 1200px、900px、700px、540px、420px
2. 观察搜索框、日期时间模块和右侧按钮的对齐情况
3. 在小屏幕上可看到元素错位、换行混乱或时间不再居中

**根本原因**:
- Header 的三列 Grid 未针对中等尺寸屏幕重新规划比例
- 日期/时间模块缺少统一约束，断点样式覆盖不完整
- Actions 区域在小屏幕时未强制换行与居中
- 日期“日”字号单独放大导致排版不协调

**修复方案**:
- 将搜索表单与 Logo 合并为左侧 Flex 容器 `.header-left`
- 新增独立的 `.header-center` 区块显示年月日与实时时钟，按语言格式化
- 重写 992/768/576/480px 断点，确保桌面端三列对齐，小屏按顺序堆叠
- 统一年月日字号和配色，使用等宽字体与轻量字重展示时间

**修复文件**:
- `frontend/src/components/Header.jsx`
- `frontend/src/components/Header.css`

**测试验证**:
- ✅ 在 1400/1200/992/768/576/480px 视口下验证搜索、时间与按钮排列
- ✅ 检查中/英/日语言下日期与时间格式正确
- ✅ 验证移动端按钮不重叠且可点击
- ✅ 确认时间每秒更新且始终居中

---

### Bug #022: 加载动画未随主题颜色同步且出现灰色方块残影

**严重程度**: 低  
**影响范围**: 所有用户（视觉体验）  
**状态**: ✅ 已修复

**问题描述**:
- 使用右上角“改变整体页面基调”功能后，重新刷新页面，加载动画仍然使用旧的蓝色基调
- 进度条环形外侧存在一层灰灰的方块感阴影，与新主题颜色不协调
- Intro 加载页的背景与实际页面背景色调不一致，显得割裂

**复现步骤**:
1. 在任意页面点击右上角主题颜色按钮，选择一个明显不同的颜色（如绿色或紫色）  
2. 刷新页面，观察加载动画的进度条与文字颜色  
3. 注意进度条周围出现灰色方块残影，且背景色与后续页面不一致

**根本原因**:
- Intro 加载页未包裹在 `ThemeProvider` 内，无法在初始化阶段读取最新主题变量  
- 加载进度条的发光阴影使用了固定的模糊样式，在部分环境下呈现为灰色矩形区域  
- 加载页背景写死为蓝色渐变，而非使用 `--background` 主题变量

**修复方案**:
- 将 `ThemeProvider` 挪到 `main.jsx`，在应用最外层包裹整个 `<App />`，包括加载动画  
- 调整 IntroLoader 的样式，使背景直接使用 `var(--background)`，进度条与文字使用 `--primary-color` 系列变量  
- 移除进度条的模糊阴影 `filter`，消除灰色方块残影

**修复文件**:
- `frontend/src/main.jsx`
- `frontend/src/App.jsx`
- `frontend/src/components/IntroLoader.jsx`
- `frontend/src/components/IntroLoader.css`

**测试验证**:
- ✅ 更换主题颜色后刷新页面，确认加载动画背景与主界面背景色调一致  
- ✅ 验证进度条环、百分比文字和 “LOADING” 文案颜色随主题变化  
- ✅ 确认进度条周围不再出现灰色方块或异常阴影

---

## 2025-12-03 - v1.5.10

### Bug #020: 通知和用户资料页面文本多语言支持

**严重程度**: 低  
**影响范围**: 所有非中文用户  
**状态**: ✅ 已修复

**问题描述**:
- 通知消息、用户资料页面和帖子卡片中文本未支持多语言

**修复方案**:
- 通知列表里的文字会随着语言切换而改变
- 个人资料页和帖子卡片的固定文案都补全了翻译

**修复文件**:
- `frontend/src/context/LanguageContext.jsx`
- `frontend/src/components/Inbox.jsx`
- `frontend/src/pages/Profile.jsx`
- `frontend/src/components/PostCard.jsx`

---

## 2025-12-03 - v1.5.8

### Bug #019: 错误提示信息未支持多语言

**严重程度**: 低  
**影响范围**: 所有非中文用户  
**状态**: ✅ 已修复

**问题描述**:
- 错误提示信息（如"加载失败"、"服务器错误"、"登录失败"等）硬编码为中文
- 非中文用户无法理解错误信息，影响用户体验
- 板块分类名称未支持多语言，始终显示中文名称
- 右侧标签容器提示文本未支持多语言

**复现步骤**:
1. 将语言切换为英文或日文
2. 触发任意错误（如网络错误、登录失败等）
3. 发现错误提示仍为中文
4. 查看板块分类，发现名称仍为中文

**根本原因**:
- 错误提示信息直接硬编码在组件中，未使用翻译系统
- 板块分类名称直接从数据库读取，未进行翻译处理
- 部分UI文本未添加到翻译系统中

**修复方案**:
- 在 LanguageContext 中添加完整的错误提示翻译键（`error.*`）
- 为板块分类名称创建翻译映射（`category.*`）
- 更新所有组件使用翻译函数显示错误信息和分类名称
- 添加 `getCategoryName()` 函数处理分类名称翻译
- 在组件层面实现错误消息的自动翻译检测

**修复文件**:
- `frontend/src/context/LanguageContext.jsx`
- `frontend/src/components/Sidebar.jsx`
- `frontend/src/components/RightSidebar.jsx`
- `frontend/src/pages/Home.jsx`
- `frontend/src/components/ErrorBoundary.jsx`
- `frontend/src/context/AuthContext.jsx`
- `frontend/src/components/LoginModal.jsx`
- `frontend/src/components/RegisterModal.jsx`
- `frontend/src/pages/CreatePost.jsx`
- `frontend/src/pages/PostDetail.jsx`
- `frontend/src/components/PostCard.jsx`

**测试验证**:
- ✅ 验证错误提示在三种语言下均能正确显示
- ✅ 验证板块分类名称在三种语言下均能正确显示
- ✅ 验证右侧标签容器提示文本在三种语言下均能正确显示
- ✅ 验证默认语言为英文
- ✅ 验证所有错误场景的提示信息都能正确翻译

---

## 2025-12-02 - v1.5.5

### Bug #016: 标签系统缺少物理效果和交互性

**严重程度**: 低  
**影响范围**: 所有用户（功能增强）  
**状态**: ✅ 已修复

**问题描述**:
- 标签系统使用简单的CSS动画，缺少真实的物理效果
- 标签无法拖拽，交互性不足
- 标签样式过于复杂，有色块和装饰，影响视觉效果
- 标签密度较低，占用空间较大
- 在响应式设备上可能影响其他内容的显示

**复现步骤**:
1. 打开REForum首页
2. 观察右侧标签区域
3. 发现标签只是简单的CSS动画，没有物理效果
4. 尝试拖拽标签，发现无法拖拽

**根本原因**:
- 使用纯CSS实现标签效果，无法实现真实的物理模拟
- 缺少物理引擎支持，无法实现碰撞、重力等效果
- 标签样式设计过于复杂

**修复方案**:
- 集成Matter.js物理引擎，实现真实的物理模拟
- 标签从容器上方掉落，具有重力、碰撞、摩擦等物理属性
- 实现标签拖拽功能，支持鼠标和触摸
- 简化标签样式，移除色块和装饰
- 减小标签尺寸，提高密度
- 优化响应式布局，确保不影响其他内容

**修复文件**:
- `frontend/src/components/RightSidebar.jsx`
- `frontend/src/components/RightSidebar.css`
- `frontend/src/App.css`
- `frontend/package.json`

**测试验证**:
- ✅ 验证标签从上方掉落效果
- ✅ 验证标签拖拽功能（鼠标和触摸）
- ✅ 验证标签碰撞效果
- ✅ 验证响应式设备上的显示
- ✅ 验证不影响其他内容布局

**相关提交**:
- Commit: `feat: Implement Matter.js physics engine for tags`

---

## 2025-12-02 - v1.5.4

### Bug #015: Header左右边距不对称（历史遗留问题）

**严重程度**: 低  
**影响范围**: 所有用户（视觉问题）  
**状态**: ✅ 已修复

**问题描述**:
- Header中左侧Logo与左侧边缘的距离和右侧按钮组合与右侧边缘的距离不一致
- 导致左右视觉不平衡，影响整体美观
- 这是一个历史遗留问题，多个版本更新迭代都未修复
- 在所有响应式断点下都存在此问题

**复现步骤**:
1. 打开REForum首页
2. 观察Header区域
3. 对比左侧Logo到左边缘的距离和右侧按钮组合到右边缘的距离
4. 发现左右距离不一致

**根本原因**:
- Grid布局中左右列虽然使用 `1fr`，但实际宽度可能因内容不同而不一致
- Logo和按钮组合可能有额外的margin或padding影响对齐
- 缺少确保左右严格对称的CSS规则

**修复方案**:
- 使用 `minmax(0, 1fr)` 替代 `1fr`，确保Grid布局中左右列严格等宽
- 移除Logo和按钮组合的额外margin和padding，设置为 `margin: 0; padding: 0;`
- 添加 `width: fit-content` 确保元素紧贴各自列的边缘
- 在所有响应式断点下保持左右对称

**修复文件**:
- `frontend/src/components/Header.css`

**测试验证**:
- ✅ 在所有响应式断点下验证左右边距对称
- ✅ 确认Logo和按钮组合都紧贴各自边缘
- ✅ 验证Grid布局中左右列严格等宽

**相关提交**:
- Commit: `fix: Header left-right margin asymmetry (historical issue)`

---

## 2025-12-02 - v1.5.3

### Bug #014: 响应式设备上Header按钮排版错乱

**严重程度**: 中等  
**影响范围**: 移动端和小屏幕用户  
**状态**: ✅ 已修复

**问题描述**:
- 将语言切换按钮从左下角移到右上角后，在响应式设备上出现排版错乱
- 多个按钮（主题切换、语言切换、Inbox、发布、登录/注册、用户头像）在小屏幕上挤在一起
- 按钮可能换行不当或溢出容器
- 在480px以下超小屏幕上布局问题更明显

**复现步骤**:
1. 在移动设备或浏览器开发者工具中打开REForum
2. 调整窗口宽度到不同断点（992px, 768px, 576px, 480px）
3. 观察右上角按钮区域的布局
4. 发现按钮可能重叠、换行不当或溢出

**根本原因**:
- Header actions区域在响应式断点下缺少足够的布局优化
- 按钮flex布局在小屏幕上没有正确处理换行和间距
- 480px以下断点缺少专门的处理
- 图标按钮和文字按钮的尺寸在小屏幕上不协调

**修复方案**:
- 优化992px、768px、576px断点的按钮布局
- 添加480px断点的专门处理
- 确保按钮在所有断点下都能正确换行和排列
- 调整按钮padding和font-size，确保在小屏幕上可读
- 优化语言菜单在小屏幕上的定位
- 确保图标按钮和文字按钮的尺寸协调

**修复文件**:
- `frontend/src/components/Header.css`

**测试验证**:
- ✅ 在992px、768px、576px、480px断点下测试按钮布局
- ✅ 验证按钮不会重叠或溢出
- ✅ 确认按钮换行合理，间距适当
- ✅ 验证语言菜单在小屏幕上正确定位

**相关提交**:
- Commit: `fix: Responsive header button layout issues on mobile devices`

---

## 2025-12-02 - v1.5.2

### Bug #013: 路由切换时标签位置重置

**严重程度**: 中等  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 切换页面（如点击更新日志、问题修复等按钮）时，右侧标签的浮动位置和动画参数被重置
- 标签位置重新随机生成，导致视觉上的跳跃
- 动画参数（持续时间、延迟、方向）每次渲染都重新生成，导致动画不连贯

**复现步骤**:
1. 打开 REForum 首页，观察右侧标签的浮动位置
2. 点击"更新日志"或"问题修复"等按钮切换页面
3. 返回首页，发现标签位置和动画已经重置

**根本原因**:
- `useEffect` 依赖 `tags` 数组，每次组件重新渲染时都会重新生成位置
- 动画参数在每次渲染时都使用 `Math.random()` 重新生成
- 没有使用缓存机制来持久化位置和动画参数

**修复方案**:
- 使用 `useMemo` 生成标签签名，基于标签ID和postCount
- 使用 `useRef` 缓存位置数据和动画参数
- 仅在标签数据真正改变时（签名改变）才重新生成位置
- 动画参数存储在缓存中，避免每次渲染都重新生成

**修复文件**:
- `frontend/src/components/RightSidebar.jsx`

**测试验证**:
- ✅ 切换页面时标签位置保持不变
- ✅ 动画参数持久化，动画连贯
- ✅ 标签数据改变时正确重新生成位置

**相关提交**:
- Commit: `fix: Prevent tag position reset on route change`

---

## 2025-12-02 - v1.5.1

### Bug #012: 移动端通知下拉菜单显示不全

**严重程度**: 中等  
**影响范围**: 移动端用户  
**状态**: ✅ 已修复

**问题描述**:
- 在移动设备上，通知下拉菜单被截断或显示不完整
- 通知内容可能被底部导航栏遮挡
- 小屏幕上通知文字过大，导致显示不全

**复现步骤**:
1. 在移动设备上打开 REForum
2. 点击右上角的通知图标
3. 通知下拉菜单可能被截断或显示不完整

**根本原因**:
- 通知下拉菜单使用绝对定位，在移动端可能超出视口
- 缺少针对移动端的响应式样式
- 最大高度计算未考虑移动端底部导航栏

**修复方案**:
- 在移动端（768px 以下）使用固定定位（fixed positioning）
- 调整下拉菜单的位置和尺寸，确保完全显示在视口内
- 优化通知项的字体大小和内边距
- 改进最大高度计算，避免内容被遮挡

**修复文件**:
- `frontend/src/components/Inbox.css`

**测试验证**:
- ✅ 在移动设备上测试通知下拉菜单完全显示
- ✅ 验证不同屏幕尺寸下的显示效果
- ✅ 确认通知内容不被底部导航栏遮挡

**相关提交**:
- Commit: `fix: Mobile notification dropdown display issues`

---

## 2025-12-02 - v1.5.7

### Bug #017: 移动端通知列表仍然显示不全（残留问题）

**严重程度**: 中等  
**影响范围**: 移动端用户  
**状态**: ✅ 已修复

**问题描述**:
- 部分设备上通知下拉菜单虽然不再被遮挡，但长列表仍然无法完全滚动查看
- 顶部标题区域与列表共同挤占空间，导致可用高度不足

**复现步骤**:
1. 在移动设备上打开 REForum
2. 点击右上角通知图标，打开通知下拉菜单
3. 当通知数量较多时，最上方或最下方的通知会被截断，无法完整查看

**根本原因**:
- 下拉菜单 `max-height` 预留空间过大，导致实际可滚动区域不足
- 列表内部仍设置了 `max-height`，与外层高度限制叠加
- 头部区域未设置 `flex-shrink: 0`，在极端情况下会与列表互相挤压

**修复方案**:
- 调整移动端下拉菜单的 `max-height` 计算，减少多余的留白
- 移除列表内部的固定 `max-height`，改为依赖外层容器 + `flex: 1` 自动分配高度
- 为 `.inbox-header` 添加 `flex-shrink: 0`，保证标题区域不会被压缩

**修复文件**:
- `frontend/src/components/Inbox.css`

**测试验证**:
- ✅ 在多台不同分辨率手机上检查长列表通知滚动行为
- ✅ 确认顶部标题始终清晰可见
- ✅ 确认所有通知可以通过滚动完整查看

---

### Bug #018: 桌面端语言切换菜单难以点击

**严重程度**: 低  
**影响范围**: 桌面端用户  
**状态**: ✅ 已修复

**问题描述**:
- 语言切换图标悬浮后，菜单在鼠标稍微移出时就会立即关闭
- 用户很难将鼠标移动到菜单项上完成点击，导致语言无法正常切换

**复现步骤**:
1. 在桌面浏览器中打开 REForum
2. 将鼠标移动到右上角语言切换按钮上，弹出语言菜单
3. 尝试移动到菜单项上点击，菜单会在移动过程中自动收起

**根本原因**:
- 语言菜单的显示与隐藏依赖 `onMouseEnter` / `onMouseLeave` 事件
- 菜单与按钮之间存在细小空隙，鼠标经过空隙时会被视为“离开”

**修复方案**:
- 移除 `onMouseEnter` / `onMouseLeave` 控制逻辑，改为仅通过点击按钮开关菜单
- 使用全局点击监听，在点击菜单外部或选择语言后关闭菜单

**修复文件**:
- `frontend/src/components/Header.jsx`
- `frontend/src/components/Header.css`

**测试验证**:
- ✅ 在桌面端测试语言菜单可以稳定打开和点击
- ✅ 连续快速切换语言时菜单表现正常
- ✅ 点击页面其它区域时菜单能够正确关闭

---

## 2025-12-02 - v1.4.0

### Bug #004: 问题修复列表排版统一

**严重程度**: 低  
**影响范围**: 所有用户（视觉问题）  
**状态**: ✅ 已修复

**问题描述**:
- 问题修复列表在不同屏幕宽度下卡片间距与内容对齐不一致

**修复方案**:
- 列表改用响应式网格，桌面与移动端保持整齐排列
- 梳理标题、描述、要点之间的行高与留白

**修复文件**:
- `frontend/src/pages/Fixes.css`

---

### Bug #005: 夜间模式下修复页和下拉菜单不可见

**严重程度**: 低  
**影响范围**: 使用夜间模式的用户  
**状态**: ✅ 已修复

**问题描述**:
- 夜间主题下卡片及发帖页下拉框的对比度不足，难以看清

**修复方案**:
- 修复卡片、标签等采用主题变量，暗色下仍清晰
- 发帖页板块下拉继承正确的文字颜色

**修复文件**:
- `frontend/src/pages/Fixes.css`
- `frontend/src/pages/CreatePost.css`

---

### Bug #006: 夜间模式表单文字发灰

**严重程度**: 低  
**影响范围**: 使用夜间模式的用户  
**状态**: ✅ 已修复

**问题描述**:
- 发帖页输入框和提示文字在夜间模式下显示为灰色，难以看清

**修复方案**:
- 标题、内容、标签输入统一使用夜间主色/次色
- 下拉选择器前景色同步更新，避免暗底暗字

**修复文件**:
- `frontend/src/pages/CreatePost.css`

---

### Bug #007: 导航按钮在小屏挤成竖排

**严重程度**: 中等  
**影响范围**: 移动端用户  
**状态**: ✅ 已修复

**问题描述**:
- 移动端顶部按钮拥挤与换行异常

**修复方案**:
- 夜间模式和发布按钮增加外边距控制，防止竖排
- 中小屏允许按钮换行并居中，极窄屏仅显示图标

**修复文件**:
- `frontend/src/components/Header.css`

---

### Bug #008: 移动端资料页排版错乱

**严重程度**: 中等  
**影响范围**: 移动端用户  
**状态**: ✅ 已修复

**问题描述**:
- 资料页在窄屏设备上布局混乱

**修复方案**:
- 头像与统计信息支持换行并自动居中
- 删除按钮位置调整，避免遮挡帖子

**修复文件**:
- `frontend/src/pages/Profile.css`

---

### Bug #009: 搜索结果无法匹配关键词

**严重程度**: 中等  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 搜索统计缺失的用户表关联，导致搜索结果为空

**修复方案**:
- 统一列表查询与统计的 JOIN/WHERE 语句
- 仍支持标题、内容、作者用户名的模糊匹配

**修复文件**:
- `backend/controllers/postController.js`

---

### Bug #010: 图片跨域策略导致无法显示

**严重程度**: 高  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 安全策略过严造成的图片加载失败

**修复方案**:
- 调整后端安全头，允许跨源资源加载
- Nginx 转发路径统一使用带尾斜杠的 proxy_pass

**修复文件**:
- `backend/server.js`
- `nginx-reforum.conf`

---

### Bug #011: 图片地址拼接成 https://uploads/

**严重程度**: 高  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 生产环境下图片 URL 拼接错误

**修复方案**:
- 统一使用后端域名 origin 来拼接图片路径
- 区分开发代理与生产 API 基址

**修复文件**:
- `frontend/src/utils/api.js`

---

### Bug #002: 通知功能返回 500 错误

**严重程度**: 高  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 访问通知 API 时返回 500 内部服务器错误
- 创建帖子后其他用户没有收到通知
- 前端控制台显示 "Failed to fetch unread count" 和 "Failed to fetch notifications"

**复现步骤**:
1. 登录账户
2. 查看右上角通知图标
3. 控制台显示 500 错误

**根本原因**:
- 数据库表 `notifications` 未创建
- 缺少表存在性检查
- 错误处理不够详细

**修复方案**:
- 添加数据库表存在性检查
- 改进错误处理和日志记录
- 创建详细的设置指南文档
- 更新诊断脚本检查 notifications 表

**修复文件**:
- `backend/models/Notification.js`
- `backend/controllers/notificationController.js`
- `backend/scripts/check-backend.js`
- `docs/NOTIFICATION_SETUP.md`

**测试验证**:
- ✅ 运行数据库迁移脚本
- ✅ 验证通知 API 正常工作
- ✅ 确认创建帖子时生成通知

**相关提交**:
- Commit: `fix: Improve notification error handling and add table existence check`

---

## 2025-12-01 - v1.3.2

### Bug #003: 移动端响应式布局问题

**严重程度**: 中等  
**影响范围**: 移动端用户  
**状态**: ✅ 已修复

**问题描述**:
- 帖子详情页标题在小屏幕上过大
- 首页和帖子卡片在移动端布局拥挤
- 错误状态提示在窄屏上显示不佳

**修复方案**:
- 添加 768px 和 480px 断点的响应式样式
- 优化字体大小、间距和布局

**修复文件**:
- `frontend/src/pages/PostDetail.css`
- `frontend/src/pages/Home.css`
- `frontend/src/components/PostCard.css`
- `frontend/src/App.css`

---

## 2025-12-01 - v1.3.1

### Bug #002: 频繁请求导致数据加载失败

**严重程度**: 中等  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 用户快速操作（切换排序、搜索、切换分类等）时，请求过于频繁导致后端数据加载不出来的问题

**修复方案**:
- 提高系统可处理的请求数量，减少请求限制
- 优化快速操作时的请求处理，避免重复请求
- 延长请求等待时间，提高成功率
- 改进错误提示，更清楚地告知用户问题原因

**修复文件**:
- `frontend/src/pages/Home.jsx`
- `backend/middleware/rateLimiter.js`

---

## 2025-12-01 - v1.3.0

### Bug #001: 删除帖子后标签仍显示

**严重程度**: 低  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 删除帖子会主动刷新标签列表，过滤无帖子标签

**修复方案**:
- 删除帖子后分发 postDeleted 事件
- 右侧栏监听事件并重新拉取标签数据

**修复文件**:
- `frontend/src/pages/Profile.jsx`
- `frontend/src/components/RightSidebar.jsx`

---

## Bug 分类统计

### 按严重程度
- **高**: 4 个 (#002, #010, #011, #031)
- **中等**: 21 个 (#003, #007, #008, #009, #012, #013, #014, #017, #021, #023, #025, #026, #027, #028, #032, #033, #034, #035, #036)
- **低**: 13 个 (#001, #004, #005, #006, #015, #016, #019, #022, #024, #029, #030, #037, #038)

### 按影响范围
- **所有用户**: 8 个
- **移动端用户**: 10 个
- **特定屏幕尺寸**: 2 个
- **使用夜间模式的用户**: 2 个
- **桌面端用户**: 1 个
- **非中文用户**: 1 个

### 按状态
- **已修复**: 38 个
- **待修复**: 0 个
- **已知问题**: 0 个

---

## 报告 Bug

如果发现新的 Bug，请：
1. 在 GitHub Issues 中创建问题报告
2. 提供详细的复现步骤
3. 包含错误截图和日志
4. 说明影响范围和严重程度

---

## 更新记录

- 2025-12-02: 创建 Bug Tracker 文档，记录 v1.4.0 和 v1.4.1 的 Bug
- 2025-12-02: 添加 v1.5.1 和 v1.5.2 的 Bug 修复记录
- 2025-12-02: 创建 Bug Tracker 文档，记录 v1.4.0 和 v1.4.1 的 Bug
- 2025-12-02: 添加 v1.5.1 和 v1.5.2 的 Bug 修复记录
- 2025-12-05: 更新所有 Bug 编号，从最早的版本开始连续编号（#001-#027）
- 2025-12-05: 添加 v1.8.0 的 Bug 修复记录（#027）
- 2025-12-05: 添加 v1.3.0、v1.3.1、v1.3.2 的 Bug 修复记录（#001-#003）
- 2025-12-05: 添加 v1.4.0 的多个 Bug 修复记录（#004-#011）
- 2025-12-05: 添加 v1.5.10 的 Bug 修复记录（#020）
- 2025-12-05: 简化更新日志和问题修复页面内容，修复版本日期错误，重新分配 issue 号从最早版本开始连续编号
- 2025-12-07: 添加 v1.9.0 的 Bug 修复记录（#028, #029, #030）
- 2025-12-07: 添加 v1.9.1 的 Bug 修复记录（#031, #032）
  - Bug #031: 登录后刷新页面自动退出登录和用户资料显示"用户不存在"
  - Bug #032: 编辑资料弹窗中访问 null 对象的 daysRemaining 属性导致错误
- 2025-12-08: 添加 v1.9.2 的 Bug 修复记录（#033, #034）
  - Bug #033: 帖子中作者等级不更新
  - Bug #034: 经验值条显示不正确
- 2025-12-08: 添加 v1.9.3 的 Bug 修复记录（#035）
  - Bug #035: startsWith 方法调用错误
- 2025-12-08: 添加 v1.9.4 的 Bug 修复记录（#036, #037, #038）
  - Bug #036: 编辑资料时请求参数验证失败
  - Bug #037: 响应式设备上用户名、称号和编辑按钮间距冲突
  - Bug #038: VITE_ENABLE_TEST_LOGIN 环境变量逻辑不正确

