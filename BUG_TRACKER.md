# REForum Bug Tracker

本文档记录每次版本更新迭代中出现的 Bug 及其修复情况。

---

## 2025-12-02 - v1.5.5

### Bug #008: 标签系统缺少物理效果和交互性

**严重程度**: 低  
**影响范围**: 所有用户（功能增强）  
**状态**: ✅ 已修复

**问题描述**:
- 标签系统使用简单的CSS动画，缺少真实的物理效果
- 标签无法拖拽，交互性不足
- 标签样式过于复杂，有色块和装饰，影响视觉效果
- 标签密度较低，占用空间较大
- 在响应式设备上可能影响其他内容的显示

**复现步骤**:
1. 打开REForum首页
2. 观察右侧标签区域
3. 发现标签只是简单的CSS动画，没有物理效果
4. 尝试拖拽标签，发现无法拖拽

**根本原因**:
- 使用纯CSS实现标签效果，无法实现真实的物理模拟
- 缺少物理引擎支持，无法实现碰撞、重力等效果
- 标签样式设计过于复杂

**修复方案**:
- 集成Matter.js物理引擎，实现真实的物理模拟
- 标签从容器上方掉落，具有重力、碰撞、摩擦等物理属性
- 实现标签拖拽功能，支持鼠标和触摸
- 简化标签样式，移除色块和装饰
- 减小标签尺寸，提高密度
- 优化响应式布局，确保不影响其他内容

**修复文件**:
- `frontend/src/components/RightSidebar.jsx`
- `frontend/src/components/RightSidebar.css`
- `frontend/src/App.css`
- `frontend/package.json`

**测试验证**:
- ✅ 验证标签从上方掉落效果
- ✅ 验证标签拖拽功能（鼠标和触摸）
- ✅ 验证标签碰撞效果
- ✅ 验证响应式设备上的显示
- ✅ 验证不影响其他内容布局

**相关提交**:
- Commit: `feat: Implement Matter.js physics engine for tags`

---

## 2025-12-02 - v1.5.4

### Bug #007: Header左右边距不对称（历史遗留问题）

**严重程度**: 低  
**影响范围**: 所有用户（视觉问题）  
**状态**: ✅ 已修复

**问题描述**:
- Header中左侧Logo与左侧边缘的距离和右侧按钮组合与右侧边缘的距离不一致
- 导致左右视觉不平衡，影响整体美观
- 这是一个历史遗留问题，多个版本更新迭代都未修复
- 在所有响应式断点下都存在此问题

**复现步骤**:
1. 打开REForum首页
2. 观察Header区域
3. 对比左侧Logo到左边缘的距离和右侧按钮组合到右边缘的距离
4. 发现左右距离不一致

**根本原因**:
- Grid布局中左右列虽然使用 `1fr`，但实际宽度可能因内容不同而不一致
- Logo和按钮组合可能有额外的margin或padding影响对齐
- 缺少确保左右严格对称的CSS规则

**修复方案**:
- 使用 `minmax(0, 1fr)` 替代 `1fr`，确保Grid布局中左右列严格等宽
- 移除Logo和按钮组合的额外margin和padding，设置为 `margin: 0; padding: 0;`
- 添加 `width: fit-content` 确保元素紧贴各自列的边缘
- 在所有响应式断点下保持左右对称

**修复文件**:
- `frontend/src/components/Header.css`

**测试验证**:
- ✅ 在所有响应式断点下验证左右边距对称
- ✅ 确认Logo和按钮组合都紧贴各自边缘
- ✅ 验证Grid布局中左右列严格等宽

**相关提交**:
- Commit: `fix: Header left-right margin asymmetry (historical issue)`

---

## 2025-12-02 - v1.5.3

### Bug #006: 响应式设备上Header按钮排版错乱

**严重程度**: 中等  
**影响范围**: 移动端和小屏幕用户  
**状态**: ✅ 已修复

**问题描述**:
- 将语言切换按钮从左下角移到右上角后，在响应式设备上出现排版错乱
- 多个按钮（主题切换、语言切换、Inbox、发布、登录/注册、用户头像）在小屏幕上挤在一起
- 按钮可能换行不当或溢出容器
- 在480px以下超小屏幕上布局问题更明显

**复现步骤**:
1. 在移动设备或浏览器开发者工具中打开REForum
2. 调整窗口宽度到不同断点（992px, 768px, 576px, 480px）
3. 观察右上角按钮区域的布局
4. 发现按钮可能重叠、换行不当或溢出

**根本原因**:
- Header actions区域在响应式断点下缺少足够的布局优化
- 按钮flex布局在小屏幕上没有正确处理换行和间距
- 480px以下断点缺少专门的处理
- 图标按钮和文字按钮的尺寸在小屏幕上不协调

**修复方案**:
- 优化992px、768px、576px断点的按钮布局
- 添加480px断点的专门处理
- 确保按钮在所有断点下都能正确换行和排列
- 调整按钮padding和font-size，确保在小屏幕上可读
- 优化语言菜单在小屏幕上的定位
- 确保图标按钮和文字按钮的尺寸协调

**修复文件**:
- `frontend/src/components/Header.css`

**测试验证**:
- ✅ 在992px、768px、576px、480px断点下测试按钮布局
- ✅ 验证按钮不会重叠或溢出
- ✅ 确认按钮换行合理，间距适当
- ✅ 验证语言菜单在小屏幕上正确定位

**相关提交**:
- Commit: `fix: Responsive header button layout issues on mobile devices`

---

## 2025-12-02 - v1.5.2

### Bug #005: 路由切换时标签位置重置

**严重程度**: 中等  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 切换页面（如点击更新日志、问题修复等按钮）时，右侧标签的浮动位置和动画参数被重置
- 标签位置重新随机生成，导致视觉上的跳跃
- 动画参数（持续时间、延迟、方向）每次渲染都重新生成，导致动画不连贯

**复现步骤**:
1. 打开 REForum 首页，观察右侧标签的浮动位置
2. 点击"更新日志"或"问题修复"等按钮切换页面
3. 返回首页，发现标签位置和动画已经重置

**根本原因**:
- `useEffect` 依赖 `tags` 数组，每次组件重新渲染时都会重新生成位置
- 动画参数在每次渲染时都使用 `Math.random()` 重新生成
- 没有使用缓存机制来持久化位置和动画参数

**修复方案**:
- 使用 `useMemo` 生成标签签名，基于标签ID和postCount
- 使用 `useRef` 缓存位置数据和动画参数
- 仅在标签数据真正改变时（签名改变）才重新生成位置
- 动画参数存储在缓存中，避免每次渲染都重新生成

**修复文件**:
- `frontend/src/components/RightSidebar.jsx`

**测试验证**:
- ✅ 切换页面时标签位置保持不变
- ✅ 动画参数持久化，动画连贯
- ✅ 标签数据改变时正确重新生成位置

**相关提交**:
- Commit: `fix: Prevent tag position reset on route change`

---

## 2025-12-02 - v1.5.1

### Bug #001: 移动端通知下拉菜单显示不全

**严重程度**: 中等  
**影响范围**: 移动端用户  
**状态**: ✅ 已修复

### Bug #001: 移动端通知下拉菜单显示不全

**严重程度**: 中等  
**影响范围**: 移动端用户  
**状态**: ✅ 已修复

**问题描述**:
- 在移动设备上，通知下拉菜单被截断或显示不完整
- 通知内容可能被底部导航栏遮挡
- 小屏幕上通知文字过大，导致显示不全

**复现步骤**:
1. 在移动设备上打开 REForum
2. 点击右上角的通知图标
3. 通知下拉菜单可能被截断或显示不完整

**根本原因**:
- 通知下拉菜单使用绝对定位，在移动端可能超出视口
- 缺少针对移动端的响应式样式
- 最大高度计算未考虑移动端底部导航栏

**修复方案**:
- 在移动端（768px 以下）使用固定定位（fixed positioning）
- 调整下拉菜单的位置和尺寸，确保完全显示在视口内
- 优化通知项的字体大小和内边距
- 改进最大高度计算，避免内容被遮挡

**修复文件**:
- `frontend/src/components/Inbox.css`

**测试验证**:
- ✅ 在移动设备上测试通知下拉菜单完全显示
- ✅ 验证不同屏幕尺寸下的显示效果
- ✅ 确认通知内容不被底部导航栏遮挡

**相关提交**:
- Commit: `fix: Mobile notification dropdown display issues`

---

## 2025-12-02 - v1.4.0

### Bug #002: 通知功能返回 500 错误

**严重程度**: 高  
**影响范围**: 所有用户  
**状态**: ✅ 已修复

**问题描述**:
- 访问通知 API 时返回 500 内部服务器错误
- 创建帖子后其他用户没有收到通知
- 前端控制台显示 "Failed to fetch unread count" 和 "Failed to fetch notifications"

**复现步骤**:
1. 登录账户
2. 查看右上角通知图标
3. 控制台显示 500 错误

**根本原因**:
- 数据库表 `notifications` 未创建
- 缺少表存在性检查
- 错误处理不够详细

**修复方案**:
- 添加数据库表存在性检查
- 改进错误处理和日志记录
- 创建详细的设置指南文档
- 更新诊断脚本检查 notifications 表

**修复文件**:
- `backend/models/Notification.js`
- `backend/controllers/notificationController.js`
- `backend/scripts/check-backend.js`
- `docs/NOTIFICATION_SETUP.md`

**测试验证**:
- ✅ 运行数据库迁移脚本
- ✅ 验证通知 API 正常工作
- ✅ 确认创建帖子时生成通知

**相关提交**:
- Commit: `fix: Improve notification error handling and add table existence check`

---

## 2025-12-01 - v1.3.2

### Bug #003: 头部导航按钮在特定宽度下不对齐

**严重程度**: 低  
**影响范围**: 中等屏幕用户  
**状态**: ✅ 已修复

**问题描述**:
- 在特定像素宽度下，头部导航按钮显示不对齐
- 右侧有大量留白

**修复方案**:
- 优化 Grid 布局，使用 `1fr auto 1fr` 确保左右对称
- 调整按钮对齐方式

**修复文件**:
- `frontend/src/components/Header.css`

---

## 2025-12-01 - v1.3.2

### Bug #004: 响应式布局问题

**严重程度**: 中等  
**影响范围**: 移动端用户  
**状态**: ✅ 已修复

**问题描述**:
- 帖子详情页标题在小屏幕上过大
- 首页和帖子卡片在移动端布局拥挤
- 错误状态提示在窄屏上显示不佳

**修复方案**:
- 添加 768px 和 480px 断点的响应式样式
- 优化字体大小、间距和布局

**修复文件**:
- `frontend/src/pages/PostDetail.css`
- `frontend/src/pages/Home.css`
- `frontend/src/components/PostCard.css`
- `frontend/src/App.css`

---

## Bug 分类统计

### 按严重程度
- **高**: 1 个
- **中等**: 2 个
- **低**: 1 个

### 按影响范围
- **所有用户**: 1 个
- **移动端用户**: 2 个
- **特定屏幕尺寸**: 1 个

### 按状态
- **已修复**: 4 个
- **待修复**: 0 个
- **已知问题**: 0 个

---

## 报告 Bug

如果发现新的 Bug，请：
1. 在 GitHub Issues 中创建问题报告
2. 提供详细的复现步骤
3. 包含错误截图和日志
4. 说明影响范围和严重程度

---

## 更新记录

- 2025-12-02: 创建 Bug Tracker 文档，记录 v1.4.0 和 v1.4.1 的 Bug
- 2025-12-02: 添加 v1.5.1 和 v1.5.2 的 Bug 修复记录

